---
permalink: upgrade/performing-upgrade.html
sidebar: sidebar
keywords: upgrade, how to perform a software upgrade
summary: 'When you are ready to perform the upgrade, you select the .upgrade archive and enter the provisioning passphrase. As an option, you can run the upgrade prechecks before performing the actual upgrade.'
---
= Perform the upgrade
:icons: font
:imagesdir: ../media/

[.lead]
When you are ready to perform the upgrade, you select the `.upgrade` archive and enter the provisioning passphrase. As an option, you can run the upgrade prechecks before performing the actual upgrade.

.What you'll need
You have reviewed all of the considerations and completed all of the planning and preparation steps.

== Select files

. Sign in to the Grid Manager using a xref:../admin/web-browser-requirements.adoc[supported web browser].
. Select *Maintenance* > *System* > *Software update*.

. From the StorageGRID upgrade tile, select *Upgrade*.
+
The Software Update page appears and shows the recommended update path. To upgrade your system, you should install the upgrades and hotfixes in the order shown. 

NOTE: If no update path is shown, your browser might not be able to access the NetApp Support Site or the *Check for software updates* check box on the AutoSupport page (*SUPPORT* > *Tools* > *AutoSupport*) might be disabled.

. On the StorageGRID Upgrade page, select the upgrade file.
 .. Select *Browse*.
 .. Locate and select the file: `NetApp_StorageGRID_11.7.0_Software_uniqueID.upgrade`
 .. Select *Open*.
+
The file is uploaded and validated. When the validation process is done, a green checkmark appears next to the upgrade file name.

. If a hotfix file is available for the new version, select the hotfix.
 .. Select *Browse*.
 .. Locate and select the latest hotfix.
 .. Select *Open*.
+
The file is uploaded and validated. When the validation process is done, a green checkmark appears next to the hotfix name.

. Select *Continue*.

== Run prechecks

. Enter the provisioning passphrase in the text box.

. xref:obtaining-required-materials-for-software-upgrade.adoc#download-the-recovery-package[Download the current copy of the Recovery Package].
+
IMPORTANT: You must download the current copy of the Recovery Package file before you upgrade the primary Admin Node. The Recovery Package file allows you to restore the system if a failure occurs. 

. Optionally, select *Run prechecks*, and wait for the prechecks to complete. 
+
Selecting *Run prechecks* allows you to detect and resolve issues before starting the upgrade. The same prechecks are performed when you start the upgrade. Precheck failures will stop the upgrade process and some might require technical support involvement to resolve.

. Follow the instructions to resolve any precheck errors that are reported.
+
IMPORTANT: If you have opened any custom firewall ports, you are notified during the precheck validation. You must contact technical support before proceeding with the upgrade.
 
. When you are ready to perform the upgrade, select *Start upgrade*.

== Upgrade primary Admin Node
When the upgrade starts, upgrade prechecks are performed, and the primary Admin Node is automatically upgraded, which includes stopping services, upgrading the software, and restarting services. You cannot access the Grid Manager while the primary Admin Node is being upgraded. Audit logs will also be unavailable. This upgrade can take up to 30 minutes.

A warning appears to remind you that your browser's connection will be lost when the primary Admin Node is rebooted.

. Select *OK* to acknowledge the warning and start the upgrade process.

. Wait for the upgrade prechecks to be performed and for the primary Admin Node to be upgraded. 
+
NOTE: If any precheck errors are reported, resolve them and select *Start upgrade* again.
+
While the primary Admin Node is being upgraded, multiple *503: Service Unavailable* and *Problem connecting to the server* messages appear, which you can ignore.
+
image::../media/software_upgrade_503_error.png[Software Upgrade 503 Error]
+
image::../media/software_upgrade_problem_connecting_error.png[Software Upgrade Problem Connecting Error]

. When a message appears indicating that the primary Admin Node upgrade is complete, select *Continue*. 

== Upgrade other nodes

. Review the summary on the StorageGRID Upgrade page, which provides information about each major upgrade task.

** *Start upgrade service* is the first upgrade task. During this task, the software file is distributed to the grid nodes, and the upgrade service is started.

** When the *Start upgrade service* task is complete, the *Upgrade other grid nodes* task starts.

.  Enter your provisioning passphrase and xref:obtaining-required-materials-for-software-upgrade.adoc#download-the-recovery-package[download a new copy of the Recovery Package].
+
IMPORTANT: You must download a new copy of the Recovery Package file after  the primary Admin Node is upgraded. The Recovery Package file allows you to restore the system if a failure occurs.

. Review the status information for the other nodes. Grid nodes are arranged in sections by type: non-primary Admin Nodes, Gateway Nodes, Storage Nodes, and Archive Nodes.
+
The stage for all grid nodes when this page first appears is *Waiting to be approved, or approved and waiting in the upgrade queue*.

. Approve the grid nodes you are ready to add to the upgrade queue. 
+
IMPORTANT: When the upgrade starts on a grid node, the services on that node are stopped. Later, the grid node is rebooted. To avoid service interruptions for client applications that are communicating with the node, do not approve the upgrade for a node unless you are sure that node is ready to be stopped and rebooted. As required, schedule a maintenance window or notify customers. 
+
You must upgrade all grid nodes in your StorageGRID system, but you can customize the upgrade sequence. You can approve individual grid nodes, groups of grid nodes, or all grid nodes.
+
If the order in which nodes are upgraded is important, approve nodes or groups of nodes one at a time and wait until the upgrade is complete on each node before approving the next node or group of nodes.
+

** Select one or more *Approve* buttons to add one or more individual nodes to the upgrade queue. If you approve more than one node of the same type, the nodes will be upgraded one at a time.

** Select the *Approve all _type_ nodes* button within each section to add all nodes of the same type to the upgrade queue.

** Select the top-level *Approve All* button to add all nodes in the grid to the upgrade queue.

** Select *Remove from queue*, *Remove all _type_ nodes* or *Remove all nodes* to remove a node, all nodes of the same type, or all nodes in the list from the upgrade queue. You cannot remove a node when its Stage reaches *Stopping services*. The *Remove* button is hidden.

. Wait for each node to proceed through the upgrade stages, which include Queued, Stopping services, Stopping container, Cleaning up Docker images, Upgrading base OS packages, Rebooting, Performing steps after reboot, Starting services, and Done.
+
NOTE: When an appliance node reaches the Upgrading base OS packages stage, the StorageGRID Appliance Installer software on the appliance is updated. This automated process ensures that the StorageGRID Appliance Installer version remains in sync with the StorageGRID software version.

== Complete upgrade

When all grid nodes have completed the upgrade stages, the *Upgrade other grid nodes* task is shown as Completed. The remaining upgrade tasks are performed automatically and in the background.

. As soon as the *Enable features* task is complete (which occurs quickly), optionally start using the new features in the upgraded StorageGRID version.

. During the *Upgrade database* task, the upgrade process checks each node to verify that the Cassandra database does not need to be updated.
+
NOTE: The upgrade from StorageGRID 11.6 to 11.7 does not require a Cassandra database upgrade; however, the Cassandra service will be stopped and restarted on each Storage Node. For future StorageGRID feature releases, the Cassandra database update step might take several days to complete.

. When the *Upgrade database* task has completed, wait a few minutes for the *Final upgrade steps* task to complete.
+
When the *Final upgrade steps* task has completed, the upgrade is done. Step 1, Select files, is redisplayed with a green success banner.


. If a hotfix is available, download the file. Then, use the xref:../maintain/storagegrid-hotfix-procedure.adoc[StorageGRID hotfix procedure] to apply the  hotfix.

. Verify that grid operations have returned to normal:
 .. Check that the services are operating normally and that there are no unexpected alerts.
 .. Confirm that client connections to the StorageGRID system are operating as expected.

