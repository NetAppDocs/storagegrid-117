---
permalink: fabricpool/use-s3-setup-wizard.html
sidebar: sidebar
keywords: fabricPool, s3 setup wizard, ontap system manager
summary: 'You can use the S3 setup wizard to configure StorageGRID as the object storage system for an ONTAP FabricPool cloud tier. After you complete the setup wizard, you can enter the required details into ONTAP System Manager..'
---
= Use S3 setup wizard
:icons: font
:imagesdir: ../media/

[.lead]

You can use the S3 setup wizard to configure StorageGRID as the object storage system for a FabricPool cloud tier. After you complete the setup wizard, you can enter the required details into ONTAP System Manager.

== When to use the S3 setup wizard

Use the S3 setup wizard unless you know you have special requirements or your implementation will require significant customization. 

For example, you cannot use the S3 Setup Wizard if S3 Object Lock is enabled for your grid. Instead, you must configure each item manually in StorageGRID. Start by xref:creating-ha-group-for-fabricpool.adoc[creating an HA group].

== How to create connections for more than one cluster

If you plan to connect the same StorageGRID system to multiple ONTAP systems, use the S3 setup wizard to create an HA group, load balancer endpoint, tenant, and bucket for the first cluster.

Then, as required, complete the wizard for each additional cluster. You can select same HA group, load balancer endpoint, and tenant, but you must select a different bucket.

== Before using the wizard

Confirm each of the following items before using the wizard:

* You have a general understanding of the xref:information-needed-to-attach-storagegrid-as-cloud-tier.adoc[information needed to attach StorageGRID as a cloud tier].
* You have reviewed the best practices for xref:best-practices-for-high-availability-groups..adoc[high availability groups] and xref:best-practices-for-load-balancing.html.adoc[load balancing].


* If you want to use a VLAN to segregate FabricPool traffic, you have already configured the VLAN interface. See xref:../admin/configure-vlan-interfaces.adoc[Configure VLAN interfaces].

* If you plan to use the StorageGRID load balancer, you have the following files: 

** The custom server certificate file.
** The custom server certificate private key file.
** Optionally, a CA bundle of the certificates from each intermediate issuing certificate authority. 
+
The certificate must include the domain name ONTAP will use for StorageGRID. 

* If you plan to use an external (third-party) load balancer endpoint, you have the fully qualified domain name (FQDN), port, and certificate for that load balancer.

* If your StorageGRID system include multiple sites, you know which site will be used to store ONTAP data.

* You are signed in to the Grid Manager using a xref:../admin/web-browser-requirements.adoc[supported web browser].
* You have the Root access permission.


== Access the wizard
. From the Grid Manager Dashboard, select *S3 setup wizard*. Or, from the header bar in the Grid Manager, select the help icon and select *S3 setup wizard*.
+
image::../media/help_menu.png[help menu]
. In the FabricPool section of the S3 setup wizard page, select *Configure now*.

== Create HA group
A high availability (HA) group is a collection of nodes that each contain the StorageGRID Load Balancer service. An HA group can contain Gateway Nodes, Admin Nodes, or both.

You can use an HA group to help keep FabricPool data connections available. If the active interface in the HA group fails, a backup interface can manage the workload with little impact on the operations of the FabricPool client.

For details about this task, see xref:../admin/managing-high-availability-groups.adoc[Manage high availability groups].

. If you will use an external load balancer, you do not need to create an HA group. Select *Skip this step*.

. To use the StorageGRID load balancer, select *Create HA group*, or select an existing group.

. To create an HA group, complete the Create a high availability group wizard:

.. Enter a unique name and optionally a description.
.. Select one or more interfaces to add to this HA group.
+
Use the column headers to sort the rows, or enter a search term to locate interfaces more quickly.

.. Determine the Primary interface and any backup interfaces for this HA group.
+
Drag and drop rows to change the values in the *Priority order* column.
+
The first interface in the list is the Primary interface. The Primary interface is the active interface unless a failure occurs.
+
If the HA group includes more than one interface and the active interface fails, the VIP addresses move to the first backup interface in the priority order. If that interface fails, the VIP addresses move to the next backup interface, and so on. When failures are resolved, the VIP addresses move back to highest priority interface available.

.. Specify the VIP subnet in CIDR notation&#8212;an IPv4 address followed by a slash and the subnet length (0-32).
+
The network address must not have any host bits set. For example, `192.16.0.0/22`.

.. Optionally, if the ONTAP IP addresses used to access StorageGRID are not on the same subnet as the StorageGRID VIP addresses, enter the StorageGRID VIP local gateway IP address. The local gateway IP address must be within the VIP subnet.

.. Enter one or more virtual IP addresses for the HA group. You can add up to 10 IP addresses. All VIPs must be within the VIP subnet.
+
You must provide at least one IPv4 address. Optionally, you can specify additional IPv4 and IPv6 addresses.

.. Select *Create HA group* and then select *Finish* to return to the S3 setup wizard.

. Select *Continue* to create a load balancer endpoint. 


== Create load balancer endpoint
StorageGRID uses a load balancer to manage the client workload. Load balancing maximizes speed and connection capacity across multiple Storage Nodes.

You can use the StorageGRID Load Balancer service, which exists on all Gateway and Admin Nodes, or you can connect to an external (third-party) load balancer. Using the StorageGRID load balancer is recommended.

For details about this task, see xref:../admin/configuring-load-balancer-endpoints.adoc[Configure load balancer endpoints].


. To use the StorageGRID Load Balancer service, select *Create endpoint*, or select an existing endpoint. To use an external load balancer, select *External load balancer*. 
+
[role="tabbed-block"]
====

.StorageGRID load balancer
--

.. To create a StorageGRID load balancer endpoint, enter the endpoint details.
+
[cols="1a,2a" options="header"]
|===
| Field| Description
a|
Name
a|
A descriptive name for the endpoint
a|
Port
a|
The StorageGRID port you want to use for load balancing. This field defaults to 10433, but you can enter any unused external port. If you enter 80 or 443, the endpoint is configured only on Gateway Nodes, since these ports are reserved on Admin Nodes.

*Note:* Ports used by other grid services are not permitted. See the 
xref:../network/network-port-reference.adoc[Network port reference].

a|
Client type
a|
Select *S3*.
a|
Network protocol
a|
Select *HTTPS*.

*Note*: Using *HTTP* is supported but not recommended.

|===

.. Select *Continue*.

.. Specify the binding mode.
+
Use the *Global* setting (recommended) or restrict the accessibility of this endpoint to one of the following:

** Specific network interfaces of specific nodes.
** Specific high availability (HA) virtual IP addresses (VIPs). Use this selection only if you require much higher levels of isolation of workloads.

.. Select *Continue*.

.. Select *Upload Certificate* (recommended) and then browse to your server certificate, certificate private key, and optional CA bundle.

.. Select *Create* to return to the S3 setup wizard.

.. Select *Continue* to create a tenant and bucket. 

NOTE: Changes to an endpoint certificate can take up to 15 minutes to be applied to all nodes.
--

.External load balancer
--

.. To use an external load balancer, enter its fully qualified domain name (FQDN).
.. Enter the port number that FabricPool will use to connect to the external load balancer.
.. Copy the server certificate for the external load balancer and paste it here.
.. Select *Continue* to create a tenant and bucket. 

--
====

// end tabbed area


== Create tenant and bucket

A tenant is an entity that can use S3 applications to store and retrieve objects in StorageGRID. Each tenant has its own users, access keys, buckets, objects, and a specific set of capabilities.  

A bucket is a container used to store a tenant's objects and object metadata. Although some tenants might have many buckets, the tenant you use for FabricPool will use only one bucket.

You can create a new tenant and bucket or select an existing tenant and bucket.


// start tabbed area

[role="tabbed-block"]
====

.New tenant and bucket
--

.. Enter the name of the new tenant account you want to use for FabricPool. For example, FabricPool tenant.

.. Enter a password and password confirmation.
+
FabricPool will use this password to sign in as this tenant's local root user.

.. Enter the name of the bucket FabricPool will use to store ONTAP data. For example, fabricpool-bucket.
+
IMPORTANT: You cannot change the bucket name after creating the bucket.
+
Bucket names must comply with these rules:

  *** Must be unique across each StorageGRID system (not just unique within the tenant account).
  *** Must be DNS compliant.
  *** Must contain at least 3 and no more than 63 characters.
  *** Can be a series of one or more labels, with adjacent labels separated by a period. Each label must start and end with a lowercase letter or a number and can only use lowercase letters, numbers, and hyphens.
  *** Must not look like a text-formatted IP address.
  *** Should not use periods in virtual hosted style requests. Periods will cause problems with server wildcard certificate verification.

 .. Select the region for this bucket.
+
Use the default region (us-east-1) unless you expect to use ILM in the future to filter objects based on the bucket's region.

.. Select *Continue* to download the ONTAP settings. 
--

.Existing bucket
--
.. Select the tenant account you want to use for FabricPool. 
.. Select which of the tenant's buckets you want to use for FabricPool.
.. Select *Continue* to download the ONTAP settings. 
--
====

// end tabbed area


== Download ONTAP settings 

. Select *Download ONTAP settings* to save the values you've entered so far to a file that you can upload or enter into ONTAP System Manager. 
+
The file includes the information you need to configure StorageGRID as the object storage system for a FabricPool cloud tier, including: 
+
* Port and certificate for load balancer endpoint
*	Tenant account ID, username, and password, access key and secret access key
*	Bucket name 

. Optionally, copy the access key ID and the secret access key or download them to an additional `.csv` file.
+
IMPORTANT: Do not close this page until you have downloaded the ONTAP settings or copied each key to another location. You cannot view, copy, or download keys after you close this page.

. Select *Continue* configure a storage pool.


== ILM storage pool
A storage pool is a group of Storage Nodes. When you select a storage pool, you determine which nodes StorageGRID will use to store the data tiered from ONTAP.

. Select the StorageGRID site that the ONTAP cluster will connect to. 
. Select the storage pool for that site. 
. Select *Continue* to review the ILM rule.

== Review ILM rule
Information lifecycle management (ILM) rules control the placement, duration, and data protection for all objects in your StorageGRID system. 

The S3 setup wizard automatically creates the recommended ILM rule for FabricPool use. This rule applies only to the tenant and bucket you specified. It uses 2+1 erasure coding to store the data that is tiered from ONTAP. 

. Review the rule. Use the retention diagram to confirm the placement instructions.
. Select *Create and Continue*.

== Review and activate ILM policy

After the S3 setup wizard creates the ILM rule for FabricPool use, it creates a proposed ILM policy to use the new rule. When you activate the new ILM policy, StorageGRID uses that policy to manage the placement, duration, and data protection of all objects in the grid, including existing objects and newly ingested objects. In some cases, activating a new policy can cause existing objects to be moved to new locations.

See xref:using-storagegrid-ilm-with-fabricpool-data.adoc[Use StorageGRID information lifecycle management with FabricPool data] for details.

. Review the list of rules in the proposed policy, which includes the FabricPool rule, any other rules used in your active or proposed policy, and a default rule.

. Confirm that the order of the rules is correct, as follows:
+
**	If the filters for the first rule match an object, the object is stored according to that rule's placement instructions.
** If the filters for the first rule do not match the object, the object is evaluated against each subsequent rule until a match is made.
**	If no rules match an object, the default (last) rule is applied. The default rule does not use filters so it can apply to all objects.

. When you are ready to have this policy take effect, select *Activate and continue*.

IMPORTANT: Errors in an ILM policy can cause irreparable data loss. Review the policy carefully before activating.

== Create traffic classification policy

As an option, the S3 setup wizard can create a traffic classification policy that you can use to monitor the FabricPool workload. The system-created policy uses a matching rule to identify all network traffic related to the bucket you created. This policy monitors traffic only; it does not limit traffic for FabricPool or any other clients. 

. Review the policy.

. If you want to create this traffic classification policy, select *Create and continue*. 
+
As soon as FabricPool begins tiering data to StorageGRID, you can go to Traffic Classification Policies page to view network traffic metrics for this policy. Later, you can also add rules to limit other workloads and ensure that the FabricPool workload has the majority of bandwidth. 
+
See xref:creating-traffic-classification-policy-for-fabricpool.adoc[Create a traffic classification policy for FabricPool] for details.

. Otherwise, select *Skip this step*.

== Review summary 

. Review the summary.
. Select *Finish*.
+
StorageGRID is now ready to accept data from FabricPool. 

. Go to xref:configure-ontap.adoc[Configure DNS server and ONTAP System Manager] to upload or enter the saved values and to complete the configuration.





