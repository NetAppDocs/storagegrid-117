---
permalink: fabricpool/use-s3-setup-wizard.html
sidebar: sidebar
keywords: fabricPool, FabricPool and S3 setup wizard, ontap system manager
summary: 'You can use the FabricPool and S3 setup wizard to configure StorageGRID as the object storage system for an ONTAP FabricPool cloud tier. After you complete the setup wizard, you can enter the required details into ONTAP System Manager..'
---
= Use FabricPool and S3 setup wizard
:icons: font
:imagesdir: ../media/

[.lead]

You can use the FabricPool and S3 setup wizard to configure StorageGRID as the object storage system for a FabricPool cloud tier. After you complete the setup wizard, you can enter the required details into ONTAP System Manager.

== When to use the FabricPool and S3 setup wizard

The FabricPool and S3 setup wizard guides you through each step of configuring StorageGRID for use with FabricPool. As part of completing the wizard, you download a file that you can use to enter values into ONTAP System Manager. The wizard helps you to configure your system more quickly and helps to make sure your settings conform to StorageGRID and FabricPool best practices.  

You can complete the FabricPool and S3 setup wizard the very first time you sign in to the StorageGRID Grid Manager, or you can access and complete the wizard at any later time. Depending on your requirements, you can also configure some or all of the required items manually and then use the wizard to assemble the values that ONTAP needs into a single file.

Use the wizard unless you know you have special requirements or your implementation will require significant customization. For example, you cannot use the FabricPool and S3 setup wizard if S3 Object Lock is enabled for your grid. Instead, you must configure each item manually in StorageGRID. Start by xref:creating-ha-group-for-fabricpool.adoc[creating an HA group].

== How to create connections for more than one cluster

If you plan to connect the same StorageGRID system to multiple ONTAP systems, use the FabricPool and S3 setup wizard to create an HA group, load balancer endpoint, tenant, and bucket for the first cluster.

Then, as required, complete the wizard for each additional cluster. You can select same HA group, and load balancer endpoint, but you must select a different tenant and bucket.

== Before using the wizard

Confirm each of the following items before using the wizard:

* You have a general understanding of the xref:information-needed-to-attach-storagegrid-as-cloud-tier.adoc[information needed to attach StorageGRID as a cloud tier].
* You have reviewed the best practices for xref:best-practices-for-high-availability-groups.adoc[high availability groups], xref:best-practices-for-load-balancing.adoc[load balancing], and the xref:best-practices-ilm.adoc[ILM rules and policy].


* If you want to use a VLAN to segregate FabricPool traffic, you have already configured the VLAN interface. See xref:../admin/configure-vlan-interfaces.adoc[Configure VLAN interfaces].

* If you plan to use the StorageGRID load balancer, you have the following files: 

** The custom server certificate file.
** The custom server certificate private key file.
** Optionally, a CA bundle of the certificates from each intermediate issuing certificate authority. 
+
The certificate must include the domain name ONTAP will use for StorageGRID. 

* If you plan to use an external (third-party) load balancer endpoint, you have the fully qualified domain name (FQDN), port, and certificate for that load balancer.

* If your StorageGRID system include multiple sites, you know which site will be used to store ONTAP data.

* You are signed in to the Grid Manager using a xref:../admin/web-browser-requirements.adoc[supported web browser].
* You have the Root access permission.


== Access the wizard
. From the Grid Manager Dashboard, select *FabricPool and S3 setup*. Or, from the header bar in the Grid Manager, select the help icon and select *FabricPool and S3 setup*.
+
image::../media/help_menu.png[help menu]
. In the FabricPool section of the FabricPool and S3 setup wizard page, select *Configure now*.

== Create or select HA group
A high availability (HA) group is a collection of nodes that each contain the StorageGRID Load Balancer service. An HA group can contain Gateway Nodes, Admin Nodes, or both.

You can use an HA group to help keep FabricPool data connections available. If the active interface in the HA group fails, a backup interface can manage the workload with little impact on the operations of the FabricPool client.

For details about this task, see xref:../admin/managing-high-availability-groups.adoc[Manage high availability groups].

. If you will use an external load balancer, you do not need to create an HA group. Select *Skip this step* and go to <<Create or select load balancer endpoint>>.

. To use the StorageGRID load balancer, select *Create HA group*, or select an existing group.


// start tabbed area

[role="tabbed-block"]
====

.Create HA group
--

.. To create an HA group, enter a unique name and optionally a description.
.. Select one or more interfaces to add to this HA group.
+
Use the column headers to sort the rows, or enter a search term to locate interfaces more quickly.

.. Determine the Primary interface and any backup interfaces for this HA group.
+
Drag and drop rows to change the values in the *Priority order* column.
+
The first interface in the list is the Primary interface. The Primary interface is the active interface unless a failure occurs.
+
If the HA group includes more than one interface and the active interface fails, the VIP addresses move to the first backup interface in the priority order. If that interface fails, the VIP addresses move to the next backup interface, and so on. When failures are resolved, the VIP addresses move back to highest priority interface available.

.. Specify the VIP subnet in CIDR notation&#8212;an IPv4 address followed by a slash and the subnet length (0-32).
+
The network address must not have any host bits set. For example, `192.16.0.0/22`.

.. Optionally, if the ONTAP IP addresses used to access StorageGRID are not on the same subnet as the StorageGRID VIP addresses, enter the StorageGRID VIP local gateway IP address. The local gateway IP address must be within the VIP subnet.

.. Enter one or more virtual IP addresses for the HA group. You can add up to 10 IP addresses. All VIPs must be within the VIP subnet.
+
You must provide at least one IPv4 address. Optionally, you can specify additional IPv4 and IPv6 addresses.

.. Select *Create HA group* and then select *Finish* to return to the FabricPool and S3 setup wizard.
.. Select *Continue* to create or select the load balancer endpoint.
--

.Existing HA group
--
.. To use an existing HA group, select its name from the drop-down list. 
.. Select *Continue* to create or select the load balancer endpoint. 
--
====

// end tabbed area


== Create or select load balancer endpoint
StorageGRID uses a load balancer to manage the client workload. Load balancing maximizes speed and connection capacity across multiple Storage Nodes.

You can use the StorageGRID Load Balancer service, which exists on all Gateway and Admin Nodes, or you can connect to an external (third-party) load balancer. Using the StorageGRID load balancer is recommended.

For details about this task, see xref:../admin/configuring-load-balancer-endpoints.adoc[Configure load balancer endpoints].


. To use the StorageGRID Load Balancer service, select *Create endpoint* or *Select an existing load balancer endpoint*. To use an external load balancer, select the *External load balancer* tab. 
+
[role="tabbed-block"]
====

.Create endpoint
--

.. To create a load balancer endpoint, enter the endpoint details.
+
[cols="1a,2a" options="header"]
|===
| Field| Description
a|
Name
a|
A descriptive name for the endpoint
a|
Port
a|
The StorageGRID port you want to use for load balancing. This field defaults to 10433, but you can enter any unused external port. If you enter 80 or 443, the endpoint is configured only on Gateway Nodes, since these ports are reserved on Admin Nodes.

*Note:* Ports used by other grid services are not permitted. See the 
xref:../network/network-port-reference.adoc[Network port reference].

a|
Client type
a|
Select *S3*.
a|
Network protocol
a|
Select *HTTPS*.

*Note*: Using *HTTP* is supported but not recommended.

|===

.. Select *Continue*.

.. Specify the binding mode.
+
Use the *Global* setting (recommended) or restrict the accessibility of this endpoint to one of the following:

** Specific network interfaces of specific nodes.
** Specific high availability (HA) virtual IP addresses (VIPs). Use this selection only if you require much higher levels of isolation of workloads.

.. Select *Continue*.

.. Select *Upload Certificate* (recommended) and then browse to your server certificate, certificate private key, and optional CA bundle.

.. Select *Create* to return to the FabricPool and S3 setup wizard.

.. Select *Continue* to create or select the tenant and bucket. 

NOTE: Changes to an endpoint certificate can take up to 15 minutes to be applied to all nodes.
--

.Existing load balancer endpoint
--
.. To use an existing endpoint, select its name from the drop-down list. 
.. Select *Continue* to create or select the tenant and bucket. 
--


.External load balancer
--

.. To use an external load balancer, enter its fully qualified domain name (FQDN).
.. Enter the port number that FabricPool will use to connect to the external load balancer.
.. Copy the server certificate for the external load balancer and paste it here.
.. Select *Continue* to create or select the tenant and bucket. 

--
====

// end tabbed area


== Create or select tenant and bucket

A tenant is an entity that can use S3 applications to store and retrieve objects in StorageGRID. Each tenant has its own users, access keys, buckets, objects, and a specific set of capabilities.  

A bucket is a container used to store a tenant's objects and object metadata. Although some tenants might have many buckets, the tenant you use for FabricPool will use only one bucket.

You can create a new tenant and bucket or select an existing tenant and bucket. The system automatically creates the access key and secret access key for the tenant's root user.


// start tabbed area

[role="tabbed-block"]
====

.New tenant and bucket
--

.. To create a new tenant and bucket, enter the name of the new tenant. For example, FabricPool tenant.

.. Enter a password and password confirmation for the tenant's local root user. 
+
FabricPool will use this password to sign in.

.. Enter the name of the bucket FabricPool will use to store ONTAP data. For example, fabricpool-bucket.
+
IMPORTANT: You cannot change the bucket name after creating the bucket.
+
Bucket names must comply with these rules:

  *** Must be unique across each StorageGRID system (not just unique within the tenant account).
  *** Must be DNS compliant.
  *** Must contain at least 3 and no more than 63 characters.
  *** Can be a series of one or more labels, with adjacent labels separated by a period. Each label must start and end with a lowercase letter or a number and can only use lowercase letters, numbers, and hyphens.
  *** Must not look like a text-formatted IP address.
  *** Should not use periods in virtual hosted style requests. Periods will cause problems with server wildcard certificate verification.

 .. Select the region for this bucket.
+
Use the default region (us-east-1) unless you expect to use ILM in the future to filter objects based on the bucket's region.

.. Select *Create and Continue* to download the FabricPool settings for ONTAP. 
--

.Existing tenant and bucket
--
.. To use an existing tenant and bucket, select the tenant account's name from the drop-down list. 
.. Select the bucket you want to use for FabricPool.
.. Select *Continue* to download the ONTAP settings. 
--
====

// end tabbed area


== Download ONTAP settings 

. To save the values you've entered so far and the access keys to a text file, select *Download*.
+
Later, you can upload or enter these values into ONTAP System Manager. 
+
The file includes the information you need to configure StorageGRID as the object storage system for a FabricPool cloud tier, including: 
+
* Port and certificate for load balancer endpoint
* FQDN from the load balancer certificate
*	Tenant account ID and password for the local root user
*	Bucket name 
* Access key ID and secret access key

. Optionally, copy the access key ID and the secret access key and save them to a save location.
+
IMPORTANT: Do not close this page until you have downloaded the ONTAP settings or copied each key to another location. You cannot view, copy, or download keys after you close this page.

. Select *Continue* to select a storage pool.


== Select ILM storage pool
A storage pool is a group of Storage Nodes. When you select a storage pool, you determine which nodes StorageGRID will use to store the data tiered from ONTAP.

. Select the StorageGRID site that the ONTAP cluster will connect to. 
. Select the storage pool for that site. 
. Select *Continue* to create or review the ILM rule.

== Review ILM rule
Information lifecycle management (ILM) rules control the placement, duration, and ingest behavior for all objects in your StorageGRID system. 

The FabricPool and S3 setup wizard automatically creates the recommended ILM rule for FabricPool use. This rule applies only to the bucket you specified. It uses 2+1 erasure coding to store the data that is tiered from ONTAP. 

. Review the rule. Use the retention diagram to confirm the placement instructions.
. Select *Create and Continue*.

== Review and activate ILM policy

After the FabricPool and S3 setup wizard creates the ILM rule for FabricPool use, it creates a proposed ILM policy to use the new rule. The new proposed policy is a clone of the current active policy. The new FabricPool ILM rule is added at the top and will be the first rule evaluated. 

When you activate the new ILM policy, StorageGRID uses that policy to manage the placement, duration, and data protection of all objects in the grid, including existing objects and newly ingested objects. In some cases, activating a new policy can cause existing objects to be moved to new locations.

See xref:best-practices-ilm.adoc[Best practices for using ILM with FabricPool data] for details.

. Review the list of rules in the proposed policy, which includes the FabricPool rule, any other rules used in your active or proposed policy, and a default rule.

. Confirm that the order of the rules is correct, as follows:
+
**	If the filters for the first rule match an object, the object is stored according to that rule's placement instructions.
** If the filters for the first rule do not match the object, the object is evaluated against each subsequent rule until a match is made.
**	If no rules match an object, the default (last) rule is applied. The default rule does not use filters so it can apply to all objects.

. Select *Activate and continue*.

IMPORTANT: Errors in an ILM policy can cause irreparable data loss. Review the policy carefully before activating.

== Create traffic classification policy

As an option, the FabricPool and S3 setup wizard can create a traffic classification policy that you can use to monitor the FabricPool workload. The system-created policy uses a matching rule to identify all network traffic related to the bucket you created. This policy monitors traffic only; it does not limit traffic for FabricPool or any other clients. 

. Review the policy.

. If you want to create this traffic classification policy, select *Create and continue*. 
+
As soon as FabricPool begins tiering data to StorageGRID, you can go to Traffic Classification Policies page to view network traffic metrics for this policy. Later, you can also add rules to limit other workloads and ensure that the FabricPool workload has the majority of bandwidth. 
+
See xref:creating-traffic-classification-policy-for-fabricpool.adoc[Create a traffic classification policy for FabricPool] for details.

. Otherwise, select *Skip this step*.

== Review summary 

. Review the summary.
. Select *Finish*.
+
StorageGRID is now ready to accept data from FabricPool. 

. Go to xref:configure-ontap.adoc[Configure DNS server and ONTAP System Manager] to upload or enter the saved values and to complete the configuration.





