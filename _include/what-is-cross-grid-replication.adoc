//shared section for the tenant manager and the grid manager

== What is cross-grid replication?

Cross-grid replication is the automatic replication of objects between selected S3 buckets in two StorageGRID systems that are connected in a xref:../admin/grid-federation-overview.adoc[grid federation connection].

=== Considerations and requirements for cross-grid replication

To use cross-grid replication:

* A grid admin creates a tenant account and assigns the *Use grid federation connection* permission for a specific grid federation connection. When the new tenant is saved, an identical tenant is automatically created on the other grid in the connection.

* The tenant root user signs in to the account on each grid and creates one or more groups and users and optionally clones them to the other grid.

* The tenant root user (or a cloned tenant user with the Root Access or Manage All Buckets permission) creates identical new buckets on each grid. These buckets: 

** Must have the same name and region
** Must have versioning enabled
** Must have S3 Object Lock disabled
** Must be empty
** Must not use bucket-level encryption

* The tenant root user (or a cloned tenant user with the Root Access or Manage All Buckets permission) updates bucket settings to enable cross-grid replication. Replication can be configured to occur between buckets in one direction or in both directions.

==== [[replication-one-direction]]Replication in one direction

If you enable cross-grid replication for a bucket on only one grid, objects added to that bucket are replicated to the other grid, but objects added to the other bucket are not. In the figure, cross-grid replication is enabled for `my-bucket` from Grid 1 to Grid 2, but it is not enabled in the other direction. 

image:../media/grid-federation-cross-grid-replication-one-direction.png[image showing grid federation connection in one direction]

==== [[replication-both-directions]]Replication in both directions
If you enable cross-grid replication for the same bucket on both grids, objects added to either bucket are replicated to the other grid. In the figure, cross-grid replication is enabled for `my-bucket` in both directions. 

image:../media/grid-federation-cross-grid-replication.png[image showing replication in one direction vs replication in both directions]

=== [[client-deletes]]Considerations for deleting objects

To understand what happens when objects are deleted from a bucket that has cross-grid replication enabled, start by reviewing how objects are deleted from buckets that have versioning enabled.

* When versioning is enabled and an S3 client issues a delete request without specifying a version ID, StorageGRID does not permanently delete the object. Instead, it adds a delete marker to the bucket, which serves as the current version of the object with a new ID. The delete marker causes StorageGRID to behave as if the object was deleted.
+
If a bucket contains a delete marker for an object, a GET request without a version ID will fail with `404 No Object Found`. In contrast, a GET request with a version ID will succeed and return the requested object version.

* When versioning is enabled and an S3 client issues a delete request with a version ID, the object version is permanently removed. No delete marker is added the bucket. 

When enabling cross-grid replication for a bucket, you can specify what happens when an S3 client delete objects without specifying a version ID, as follows:

* If you choose to replicate delete markers, a delete marker is added to the source bucket and replicated to the destination bucket. In effect, objects are deleted on both grids.

*  If you choose not to replicate delete markers, a delete marker is added to the source bucket, but it is not replicated to the destination bucket. In effect, objects that the client deletes on the source grid are not deleted on the destination grid.

IMPORTANT: The option to replicate client delete markers does not affect delete object requests that include a version ID. These requests to permanently remove objects from the source grid. However, because they do not add delete markers to the bucket, they are are never replicated to the other grid.

In the figure, the grids are configured for cross-grid replication in both directions, but delete markers are not replicated from `my-bucket` on Grid 1 to `my-bucket` on Grid 2.

image:../media/grid-federation-cross-grid-replication-delete.png[image showing replicate client delete on both grids]




